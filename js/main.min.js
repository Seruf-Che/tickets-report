"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var DomElemetnt=function(){function s(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"div",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],n=2<arguments.length?arguments[2]:void 0;_classCallCheck(this,s);var i=document.createElement(e);n&&(i.innerHTML=n),t&&t.forEach(function(e){return i.classList.add(e)}),this._element=i}return _createClass(s,[{key:"element",get:function(){return this._element},set:function(e){this._element=e}}]),s}(),Spiner=function(){function s(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"main",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"spinner",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"spinner__loader";_classCallCheck(this,s),this.spinerLocation=document.querySelector(e),this.spinnerElement=new DomElemetnt("div",[t]);var i=new DomElemetnt("div",[n]);this.spinnerElement.element.appendChild(i.element)}return _createClass(s,[{key:"show",value:function(){this.spinerLocation.appendChild(this.spinnerElement.element)}},{key:"hide",value:function(){this.spinerLocation.removeChild(this.spinnerElement.element)}}]),s}(),Alert=function(){function u(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"Alert Window Text",n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"Ok",i=2<arguments.length&&void 0!==arguments[2]&&arguments[2],s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"main",l=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"alert",r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"alert__window",o=6<arguments.length&&void 0!==arguments[6]?arguments[6]:"alert__text",a=7<arguments.length&&void 0!==arguments[7]?arguments[7]:"alert__button";_classCallCheck(this,u),this.alertLocation=document.querySelector(s),this.reload=i;var d=new DomElemetnt("div",[l],""),h=new DomElemetnt("div",[r],""),m=new DomElemetnt("div",[o],t),c=new DomElemetnt("button",[a,"button"],n);c.element.addEventListener("click",function(){return e.hide()}),h.element.appendChild(m.element),h.element.appendChild(c.element),d.element.appendChild(h.element),this.alertBlock=d}return _createClass(u,[{key:"show",value:function(){this.alertLocation.appendChild(this.alertBlock.element)}},{key:"hide",value:function(){this.alertLocation.removeChild(this.alertBlock.element),this.reload&&window.location.reload()}}]),u}(),Report=function(){function e(){_classCallCheck(this,e),this.themesListAddress="https://docs.google.com/spreadsheets/d/1z7zJumlt7AZXF1GC6lU2ObMorZUxJZGSOIoiYPeQwbM/edit#gid=0",this.year=document.getElementById("year").value,this.month=document.getElementById("month").value,this.sortBy=document.getElementById("sort-by").value,this.themesList=JSON.parse(JSON.stringify(window.themesList)),this.firstTicket=0,this.lastTicket=0,this._totalTickets=0,this.totalRemovedTickets=0,this.themesListArray=[]}return _createClass(e,[{key:"calc",value:function(){for(var e=0;e<window.zendeskReport.length;e++){var t=window.zendeskReport[e].split(";");if(t&&t[1]){var n=t[0],i=t[1].slice(7,11),s=t[1].slice(4,6),l=t[2].slice(1,t[2].length-1);if(3===t.length&&i===this.year&&s===this.month){if(this.lastTicket||(this.lastTicket=n),0===l.length)this.themesList["merged-tickets"].tickets++;else{if(!this.themesList[l])return new Alert("The ".concat(l,' theme was not found in the themes list. Please proceed <a href="').concat(this.themesListAddress,'" target="_blank" style="font-weight: 700; color: #ffffff">here</a> to add it.'),"Reload",!0).show();this.themesList[l].tickets++}this.firstTicket=n,this.totalTickets++}}}if(0===this.totalTickets)return new Alert("There is not any ticket, or Zendesk report has been generated wrong").show();this.totalRemovedTickets=this.lastTicket-this.firstTicket-this.totalTickets}},{key:"sort",value:function(){var n=this;for(var e in this.themesList)0<this.themesList[e].tickets&&this.themesListArray.push(this.themesList[e]);this.themesListArray.sort(function(e,t){return"amount"===n.sortBy?t.tickets-e.tickets:e.name>t.name?1:e.name<t.name?-1:0})}},{key:"show",value:function(){var e=document.querySelector(".table");e.innerHTML="";var t=new DomElemetnt("tr").element,n=new DomElemetnt("td",!1,"Total tickets:").element,i=new DomElemetnt("td",!1,this.totalTickets).element;t.appendChild(n),t.appendChild(i),e.appendChild(t);var s=new DomElemetnt("tr").element,l=new DomElemetnt("td",!1,"Last ticket number:").element,r=new DomElemetnt("td",!1,this.lastTicket).element;s.appendChild(l),s.appendChild(r),e.appendChild(s);var o=new DomElemetnt("tr").element,a=new DomElemetnt("td",!1,"First ticket number:").element,d=new DomElemetnt("td",!1,this.firstTicket).element;o.appendChild(a),o.appendChild(d),e.appendChild(o);var h=new DomElemetnt("tr").element,m=new DomElemetnt("td",!1,"Total tickets removed:").element,c=new DomElemetnt("td",!1,this.totalRemovedTickets).element;h.appendChild(m),h.appendChild(c),e.appendChild(h);var u=new DomElemetnt("tr").element,p=new DomElemetnt("td",["table__divider"]).element,v=new DomElemetnt("td",["table__divider"]).element;u.appendChild(p),u.appendChild(v),e.appendChild(u);for(var f=0;f<this.themesListArray.length;f++){var w=this.themesListArray[f].name,k=this.themesListArray[f].tickets,g=new DomElemetnt("tr").element,C=new DomElemetnt("td",!1,w).element,E=new DomElemetnt("td",!1,k).element;g.appendChild(C),g.appendChild(E),e.appendChild(g)}}},{key:"totalTickets",get:function(){return this._totalTickets},set:function(e){this._totalTickets=e}}]),e}(),setDate=function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()-1;n<0&&(n=11,t--),document.getElementById("year").value=t,document.getElementById("month").selectedIndex=n},reportFileHandler=function(e){var t=e.target.files[0],n=document.querySelector(".calcReport");if(t){if(".csv"!==t.name.slice(-4)){e.target.value="";var i=new Alert("Sorry, ".concat(t.name," is invalid, allowed extension is .csv only"));n.disabled=!0,i.show()}var s=new FileReader;s.readAsText(t),s.onload=function(){window.zendeskReport=s.result.split("\n")},s.onabort=function(){e.target.value=""},n.disabled=!1,n.addEventListener("click",getReportButtonHandler)}},getReportButtonHandler=function(){var e=new Report;e.calc(),e.totalTickets&&(e.sort(),e.show())};setDate();var spiner=new Spiner;spiner.show();var URL="https://script.google.com/macros/s/AKfycbzohhPcfAhaS1CjMOJwIVV67PN1Ke3Z23QAnEO9WnhfrdbwJYA/exec",request=new XMLHttpRequest;request.addEventListener("load",function(){window.themesList=JSON.parse(request.responseText),spiner.hide(),document.getElementById("zendesk-report").addEventListener("change",reportFileHandler,!1)}),request.open("GET",URL,!0),request.send();